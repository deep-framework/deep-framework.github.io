<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">lib/S3FsRumProxy.js | DEEP File System Library API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="identifiers.html">Identifier</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/MitocGroup/deep-framework.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/FS.js~FS.html">FS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Registry.js~Registry.html">Registry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/S3FsRumProxy.js~S3FsRumProxy.html">S3FsRumProxy</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Exception</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Exception/Exception.js~Exception.html">Exception</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Exception/UnknownFolderException.js~UnknownFolderException.html">UnknownFolderException</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Local</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Local/S3FSRelativeFSExtender.js~S3FSRelativeFSExtender.html">S3FSRelativeFSExtender</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/S3FsRumProxy.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
 * Created by mgoria on 2/3/16.
 */

&apos;use strict&apos;;

import util from &apos;util&apos;;

/**
 * Proxy S3FS library
 */
export class S3FsRumProxy {
  /**
   * @param {Object} originalInstance
   * @param {Object} logService
   */
  constructor(originalInstance, logService) {
    this._originalInstance = originalInstance;
    this._logService = logService;
  }

  /**
   * @returns {Object}
   */
  proxy() {
    let proxy = {};

    for (let property in this._originalInstance) {
      if (typeof this._originalInstance[property] === &apos;function&apos;) {
        let originalFunction = this._originalInstance[property];

        proxy[property] = (...args) =&gt; {
          let originalCallback = null;

          // seeking the callback function through the arguments and proxy it
          args.forEach((arg, index) =&gt; {
            if (typeof arg === &apos;function&apos;) {
              originalCallback = arg;

              args[index] = (...cbArgs) =&gt; {
                this._logRumEvent({
                  eventName: property,
                  payload: {args: cbArgs},
                });

                originalCallback.call(this._originalInstance, ...cbArgs);
              };
            }
          });

          // proxy only async methods (that have a callback through args)
          if (null !== originalCallback) {
            this._logRumEvent({
              eventName: property,
              payload: {args: args},
            });
          }

          originalFunction.call(this._originalInstance, ...args);
        };
      } else {
        proxy[property] = this._originalInstance[property];
      }
    }

    return proxy;
  }

  /**
   * @param {Object} customData
   */
  _logRumEvent(customData) {
    let event = util._extend(customData, {
      service: &apos;deep-fs&apos;,
      resourceType: &apos;S3&apos;,
      resourceId: this._originalInstance.bucket,
    });

    this._logService.rumLog(event);
  }
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.3.1)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
